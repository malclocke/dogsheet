new_timeslice = '<%= escape_javascript(render(:partial => 'timesheet_row', :locals => { :timeslice => @timeslice })) %>';
<% if @next %>
$('#timeslice-<%= @next.id %>').before(new_timeslice);
<% else %>
$('#timeslice-form-<%= @timeslice.date %>').before(new_timeslice);
<% end %>

$('#dayheader-<%= @timeslice.date %> > span.summary').replaceWith('<%= escape_javascript(render(:partial => 'timesummary', :locals => { :timeslices => @timeslices })) %>');

$('.taskbadge-<%= @timeslice.task.id %>').replaceWith('<%= escape_javascript(render(:partial => @timeslice.task)) %>');

<% next_finished = @timeslice.finished + 15.minutes %>
$('#timeslice_started_time').val('<%= @timeslice.finished_time %>');
$('#timeslice_finished_time').val('<%= next_finished.to_s(:time_only) %>');
$('#timeslice_task_id').focus();
$('#timesheet-<%= @timeslice.date %> .no-timeslices').hide();
$('#timesheet-<%= @timeslice.date %>').toggle(true);
$('#dayheader-<%= @timeslice.date %>').removeClass('closed');

$('#timeslice-form-<%= @timeslice.date %> *').removeClass('fieldWithErrors');
$('#timeslice-form-errors').empty();
